<!DOCTYPE html>
<html lang="gu">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
  />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="mobile-web-app-capable" content="yes" />
  <!-- Remove all CSP that might force HTTPS -->
  <title>àªªà«àª°àª•à«ƒàª¤àª¿ àªªàª°à«€àª•à«àª·àª£- Children's Research University</title>
  <style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

html,
body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
color: #333;
height: 100vh;
width: 100vw;
background: white;
overflow: hidden;
margin: 0;
padding: 0;
font-size: 16px;
}

.container {
position: fixed;
top: 0;
right: 0;
bottom: 0;
left: 0;
background: white;
display: flex;
flex-direction: column;
overflow: hidden;
height: 100vh;
}

.header {
background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
padding: 15px;
text-align: center;
color: #333;
flex-shrink: 0;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.header h1 {
font-size: clamp(1.5rem, 4vw, 2.2rem);
margin-bottom: 5px;
font-weight: 600;
line-height: 1.2;
}

.header p {
font-size: clamp(1rem, 3vw, 1.4rem);
opacity: 0.8;
}

.logo-container {
margin-bottom: 10px;
}

.university-logo {
height: clamp(40px, 8vw, 70px);
width: auto;
max-width: 300px;
object-fit: contain;
}

.progress-container {
background: #f8f9fa;
padding: 10px 15px;
flex-shrink: 0;
box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
}

.progress-bar {
width: 100%;
height: 12px;
background: #e9ecef;
border-radius: 6px;
overflow: hidden;
margin-bottom: 10px;
}

.progress-fill {
height: 100%;
background: linear-gradient(90deg, #667eea, #764ba2);
border-radius: 6px;
transition: width 0.3s ease;
width: 0%;
}

.progress-text {
text-align: center;
font-weight: 600;
color: #666;
font-size: clamp(0.9rem, 2.5vw, 1.2rem);
}

.content {
flex: 1;
padding: 10px;
background: white;
overflow-y: auto;
display: flex;
flex-direction: column;
min-height: 0;
height: 70vh;
}

.question-card {
display: none;
height: 100%;
flex-direction: column;
justify-content: flex-start;
padding: 15px;
width: 100%;
overflow-y: auto;
}

.question-card.active {
display: flex;
}

.question-title {
font-size: clamp(1.1rem, 3.5vw, 1.6rem);
margin-bottom: 20px;
font-weight: 600;
color: #333;
line-height: 1.4;
text-align: center;
}

.options {
flex: 1;
display: flex;
flex-direction: column;
justify-content: flex-start;
margin: 15px 0;
gap: 12px;
overflow-y: auto;
min-height: 0;
}

.option {
display: block;
padding: 16px 20px;
background: #f8f9fa;
border: 3px solid transparent;
border-radius: 16px;
cursor: pointer;
font-size: clamp(0.95rem, 2.8vw, 1.3rem);
line-height: 1.3;
position: relative;
transition: all 0.3s ease;
text-align: left;
min-height: 60px;
display: flex;
align-items: center;
}

.option:hover {
background: #e9ecef;
border-color: #667eea;
}

.option input[type="radio"] {
position: absolute;
opacity: 0;
cursor: pointer;
}

.option.selected {
background: linear-gradient(135deg, #667eea, #764ba2);
color: white;
border-color: #667eea;
}

.option.selected::after {
content: "âœ“";
position: absolute;
right: 20px;
top: 50%;
transform: translateY(-50%);
font-size: 1.8rem;
font-weight: bold;
}

.navigation {
flex-direction: row;
margin-top: 15px;
gap: 10px;
display: flex;
padding: 0 15px 15px;
justify-content: space-between;
align-items: center;
}

.btn {
padding: 16px 24px;
font-size: clamp(0.9rem, 2.5vw, 1.2rem);
border: none;
border-radius: 25px;
font-weight: 600;
cursor: pointer;
text-transform: uppercase;
letter-spacing: 0.5px;
transition: all 0.3s ease;
min-height: 50px;
display: flex;
align-items: center;
justify-content: center;
}

.btn-primary {
background: linear-gradient(135deg, #667eea, #764ba2);
color: white;
flex: 1;
max-width: 200px;
}

.btn-secondary {
background: #6c757d;
color: white;
min-width: 100px;
}

.btn:disabled {
opacity: 0.6;
cursor: not-allowed;
}

.uiredegine{
width: 60%;
align-self: center;
border-style: ridge;
}

.user-info {
display: none;
background: white;
overflow-y: auto;
padding: 20px;
width: 100%;
height: 100%;
/* margin-bottom: 60px; */
}

.user-info.active {
display: block;
}

.user-info h3 {
margin-bottom: 25px;
font-size: clamp(1.3rem, 4vw, 2rem);
text-align: center;
}

.form-group {
margin-bottom: 20px;
}

.form-label {
display: block;
margin-bottom: 8px;
font-weight: 600;
color: #333;
font-size: clamp(0.9rem, 2.5vw, 1.1rem);
}

.form-input {
width: 100%;
padding: 16px;
font-size: clamp(1rem, 3vw, 1.2rem);
border: 3px solid #e9ecef;
border-radius: 12px;
transition: border-color 0.3s ease;
background: white;
}

.form-input:focus {
outline: none;
border-color: #667eea;
box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.radio-group {
display: flex;
flex-direction: column;
gap: 12px;
}

.radio-option {
display: flex;
align-items: center;
gap: 12px;
padding: 12px 20px;
background: #f8f9fa;
border-radius: 25px;
cursor: pointer;
transition: all 0.3s ease;
font-size: clamp(0.9rem, 2.5vw, 1.1rem);
}

.radio-option:hover {
background: #e9ecef;
}

.radio-option input[type="radio"] {
width: 20px;
height: 20px;
}

.radio-option input[type="radio"]:checked + span {
color: #667eea;
font-weight: 600;
}

.result {
display: none;
text-align: center;
padding: 20px;
background: white;
overflow-y: auto;
width: 100%;
height: 100%;
}

.result.active {
display: block;
}

.result-icon {
font-size: clamp(3rem, 8vw, 5rem);
margin-bottom: 20px;
}

.result-title {
font-size: clamp(1.5rem, 5vw, 2.5rem);
font-weight: 700;
margin-bottom: 20px;
background: linear-gradient(135deg, #667eea, #764ba2);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
line-height: 1.2;
}

.result-description {
font-size: clamp(1rem, 3vw, 1.4rem);
color: #666;
line-height: 1.5;
margin-bottom: 25px;
}

.result-stats {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
gap: 15px;
margin-top: 25px;
align-items: center;
}

.stat-card {
background: #f8f9fa;
padding: 20px 15px;
border-radius: 16px;
text-align: center;
}

.stat-value {
font-size: clamp(1.8rem, 5vw, 2.5rem);
font-weight: 700;
color: #667eea;
}

.stat-label {
font-size: clamp(0.9rem, 2.5vw, 1.2rem);
color: #666;
margin-top: 5px;
}

.loading {
display: none;
text-align: center;
padding: 40px 20px;
background: white;
width: 100%;
height: 100%;
justify-content: center;
align-items: center;
flex-direction: column;
}

.loading.active {
display: flex;
}

.spinner {
width: 60px;
height: 60px;
border: 6px solid #f3f3f3;
border-top: 6px solid #667eea;
border-radius: 50%;
animation: spin 1s linear infinite;
margin-bottom: 20px;
}

@keyframes spin {
0% {
  transform: rotate(0deg);
}
100% {
  transform: rotate(360deg);
}
}

.loading p {
font-size: clamp(1rem, 3vw, 1.3rem);
color: #666;
}

.error {
background: #f8d7da;
color: #721c24;
padding: 15px;
border-radius: 12px;
margin: 15px;
display: none;
font-size: clamp(0.9rem, 2.5vw, 1.1rem);
}

.error.active {
display: block;
}

.validation-message {
font-size: clamp(0.8rem, 2vw, 1rem);
padding: 8px 12px;
margin-top: 5px;
border-radius: 6px;
display: none;
}

.validation-message.error {
color: #dc3545;
background-color: #f8d7da;
border: 2px solid #f5c6cb;
display: block;
}

.validation-message.success {
color: #155724;
background-color: #d4edda;
border: 2px solid #c3e6cb;
display: block;
}

.form-input.invalid {
border-color: #dc3545;
background-color: #fff5f5;
}

.form-input.valid {
border-color: #28a745;
background-color: #f8fff8;
}

.input-group {
position: relative;
}

.validation-icon {
position: absolute;
right: 16px;
top: 50%;
transform: translateY(-50%);
font-size: 1.5rem;
}

.validation-icon.valid {
color: #28a745;
}

.validation-icon.invalid {
color: #dc3545;
}

.download-section {
margin-top: 25px;
text-align: center;
}

.download-section .btn {
display: inline-block;
text-decoration: none;
margin-top: 15px;
padding: 16px 32px;
}


/* Mobile-specific optimizations */
@media (max-width: 768px) {
.header {
  padding: 10px;
}

.question-card {
  padding: 10px;
}

.question-title {
  margin-bottom: 15px;
}

.options {
  margin: 10px 0;
  gap: 10px;
}

.option {
  padding: 14px 16px;
  min-height: 55px;
}

.navigation {
  padding: 0 10px 10px;
  flex-direction: column;
  gap: 10px;
}

.btn {
  width: 100%;
  max-width: none;
}

.user-info {
  padding: 15px;
}

.result {
  padding: 15px;
}

.result-stats {
  grid-template-columns: 1fr;
  gap: 12px;
}

.uiredegine{
width: 100%;
align-self: center;
border-style: ridge;
}

}

/* Extra small screens */
@media (max-width: 480px) {
.header h1 {
  font-size: 1.3rem;
}

.question-title {
  font-size: 1rem;
}

.option {
  font-size: 0.9rem;
  padding: 12px 14px;
  min-height: 50px;
}

.btn {
  padding: 14px 20px;
  font-size: 0.85rem;
}

.form-input {
  padding: 14px;
  font-size: 1rem;
}

.uiredegine{
  width: 100%;
  align-self: center;
  border-style: ridge;
}

}

/* Landscape mobile optimization */
@media (max-height: 600px) and (orientation: landscape) {
.header {
  padding: 8px;
}

.header h1 {
  font-size: 1.2rem;
  margin-bottom: 2px;
}

.university-logo {
  height: 30px;
}

.progress-container {
  padding: 8px 15px;
}

.question-card {
  padding: 8px;
}

.question-title {
  font-size: 0.95rem;
  margin-bottom: 10px;
}

.options {
  gap: 8px;
  margin: 8px 0;
}

.option {
  padding: 10px 14px;
  min-height: 45px;
  font-size: 0.85rem;
}

.navigation {
  padding: 0 8px 8px;
}

.btn {
  padding: 12px 20px;
  min-height: 40px;
}
}

/* Touch improvements */
@media (hover: none) and (pointer: coarse) {
.option:hover {
  background: #f8f9fa;
  border-color: transparent;
}

.option:active {
  background: #e9ecef;
  border-color: #667eea;
}

.btn:hover {
  transform: none;
}

.btn:active {
  transform: scale(0.98);
}
}

/* Smooth scrolling for survey form */
.question-card {
scroll-behavior: smooth;
}

.question-card::-webkit-scrollbar {
width: 6px;
}

.question-card::-webkit-scrollbar-track {
background: #f1f1f1;
border-radius: 3px;
}

.question-card::-webkit-scrollbar-thumb {
background: #c1c1c1;
border-radius: 3px;
}

.question-card::-webkit-scrollbar-thumb:hover {
background: #a8a8a8;
}

/* Smooth scrolling for user-info form */
.user-info {
scroll-behavior: smooth;
}

.user-info::-webkit-scrollbar {
width: 6px;
}

.user-info::-webkit-scrollbar-track {
background: #f1f1f1;
border-radius: 3px;
}

.user-info::-webkit-scrollbar-thumb {
background: #c1c1c1;
border-radius: 3px;
}

.user-info::-webkit-scrollbar-thumb:hover {
background: #a8a8a8;
}
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo-container">
        <img
          src="https://www.cugujarat.ac.in/assets/images/logo.png"
          alt="University Logo"
          class="university-logo"
        />
      </div>
      <h1>àªªà«àª°àª•à«ƒàª¤àª¿ àªªàª°à«€àª•à«àª·àª£</h1>
    </div>
    <div class="uiredegine">
    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-text" id="progressText">àª²à«‹àª¡ àª¥àªˆ àª°àª¹à«àª¯à«àª‚ àª›à«‡...</div>
    </div>
    <div class="content">
      <div class="error" id="errorMessage"></div>
      <div class="loading active" id="loading">
        <div class="spinner"></div>
        <p>àªªà«àª°àª¶à«àª¨à«‹ àª²à«‹àª¡ àª¥àªˆ àª°àª¹à«àª¯àª¾ àª›à«‡...</p>
      </div>
      <form id="surveyForm">
        <!-- Questions will be dynamically inserted here -->
      </form>
      <div class="user-info" id="userInfo">
        <h3 style="margin-bottom: 50px; color: #333; font-size: 2.6rem;">ğŸ“ àªµà«àª¯àª•à«àª¤àª¿àª—àª¤ àª®àª¾àª¹àª¿àª¤à«€</h3>
        <div class="form-group">
          <label class="form-label">àª¨àª¾àª® *</label>
          <div class="input-group">
            <input
              type="text"
              name="name"
              id="nameInput"
              class="form-input"
              required
              placeholder="àª¤àª®àª¾àª°à«àª‚ àª¨àª¾àª® àª²àª–à«‹ (àª«àª•à«àª¤ àª…àª•à«àª·àª°à«‹)"
            /><span class="validation-icon" id="nameIcon"></span>
          </div>
          <div class="validation-message" id="nameError"></div>
        </div>
        <div class="form-group">
          <label class="form-label">àª²àª¿àª‚àª— *</label>
          <div class="radio-group">
            <label class="radio-option"
              ><input type="radio" name="gender" value="Male" required /><span>àªªà«àª°à«àª·</span></label
            ><label class="radio-option"
              ><input type="radio" name="gender" value="Female" required /><span>àª¸à«àª¤à«àª°à«€</span></label
            ><label class="radio-option"
              ><input type="radio" name="gender" value="Other" required /><span>àª…àª¨à«àª¯</span></label
            >
          </div>
          <div class="validation-message" id="genderError"></div>
        </div>
        <div class="form-group">
          <label class="form-label">àª«à«‹àª¨ àª¨àª‚àª¬àª° *</label>
          <div class="input-group">
            <input
              type="tel"
              name="phone"
              id="phoneInput"
              class="form-input"
              required
              placeholder="10 àª…àª‚àª•àª¨à«‹ àª¨àª‚àª¬àª° (6-9 àª¥à«€ àª¶àª°à«‚)"
              maxlength="10"
            /><span class="validation-icon" id="phoneIcon"></span>
          </div>
          <div class="validation-message" id="phoneError"></div>
        </div>
        <div class="form-group">
          <label class="form-label">àªˆàª®à«‡àª² *</label>
          <div class="input-group">
            <input
              type="email"
              name="email"
              id="emailInput"
              class="form-input"
              required
              placeholder="àª¤àª®àª¾àª°à«àª‚ àªˆàª®à«‡àª² àª¸àª°àª¨àª¾àª®à«àª‚"
            /><span class="validation-icon" id="emailIcon"></span>
          </div>
          <div class="validation-message" id="emailError"></div>
        </div>
        <div class="form-group">
          <label class="form-label">àª¶àª¹à«‡àª° *</label>
          <div class="input-group">
            <input
              type="text"
              name="city"
              id="cityInput"
              class="form-input"
              required
              placeholder="àª¤àª®àª¾àª°à«àª‚ àª¶àª¹à«‡àª° (àª«àª•à«àª¤ àª…àª•à«àª·àª°à«‹)"
            /><span class="validation-icon" id="cityIcon"></span>
          </div>
          <div class="validation-message" id="cityError"></div>
        </div>
        <div class="navigation">
          <button type="button" class="btn btn-secondary" id="backToQuestions">àªªàª¾àª›àª¾ àªœàª¾àª“</button
          ><button type="button" class="btn btn-primary" id="finalSubmit">àªªàª°àª¿àª£àª¾àª® àªœà«àª“</button>
        </div>
      </div>
      <div class="result" id="result">
        <div class="result-icon">ğŸ¯</div>
        <h2 class="result-title" id="resultTitle"></h2>
        <p class="result-description" id="resultDescription"></p>
        <div class="result-stats" id="resultStats"></div>
      </div>
    </div>
    </div>
  </div>
  <script>
    console.log("AyurvedicSurvey script started."); // Add this line

    class AyurvedicSurvey {
      constructor() {
        this.questions = []
        this.currentIndex = 0
        this.answers = {}
        this.totalQuestions = 0
        this.initializeElements()
        this.loadQuestions()
      }

      initializeElements() {
        this.form = document.getElementById('surveyForm')
        this.userInfo = document.getElementById('userInfo')
        this.result = document.getElementById('result')
        this.loading = document.getElementById('loading')
        this.errorMessage = document.getElementById('errorMessage')
        this.progressFill = document.getElementById('progressFill')
        this.progressText = document.getElementById('progressText')
        this.setupEventListeners()
      }

      setupEventListeners() {
        document.getElementById('backToQuestions').addEventListener('click', () => {
          this.showQuestions()
        })
        document.getElementById('finalSubmit').addEventListener('click', () => {
          this.submitSurvey()
        })
        this.setupValidation()
      }

      setupValidation() {
        const nameInput = document.getElementById('nameInput')
        if (nameInput) {
          nameInput.addEventListener('input', () => this.validateName())
          nameInput.addEventListener('blur', () => this.validateName())
        }
        const phoneInput = document.getElementById('phoneInput')
        if (phoneInput) {
          phoneInput.addEventListener('input', () => this.validatePhone())
          phoneInput.addEventListener('blur', () => this.validatePhone())
        }
        const emailInput = document.getElementById('emailInput')
        if (emailInput) {
          emailInput.addEventListener('input', () => this.validateEmail())
          emailInput.addEventListener('blur', () => this.validateEmail())
        }
        const cityInput = document.getElementById('cityInput')
        if (cityInput) {
          cityInput.addEventListener('input', () => this.validateCity())
          cityInput.addEventListener('blur', () => this.validateCity())
        }
      }

      async loadQuestions() {
        try {
          // Use relative URL to avoid protocol issues
          const apiUrl = '/api/questions';
          
          //console.log('Making request to:', apiUrl);
          // console.log('Current location:', {
          //   protocol: window.location.protocol,
          //   hostname: window.location.hostname,
          //   port: window.location.port,
          //   origin: window.location.origin
          // });
          
          const response = await fetch(apiUrl, {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json',
              'X-Requested-With': 'XMLHttpRequest'
            },
            credentials: 'same-origin'
          });
          
          //console.log('Response status:', response.status);
          //console.log('Response headers:', [...response.headers.entries()]);
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status} - ${response.statusText}`);
          }
          
          const data = await response.json();
          //console.log('Questions loaded successfully:', data.questions.length);
          
          this.questions = data.questions;
          this.totalQuestions = this.questions.length;
          this.loading.classList.remove('active');
          this.showQuestion();
        } catch (error) {
          //console.error('Detailed error:', error);
          //console.error('Error type:', error.constructor.name);
          //console.error('Error message:', error.message);
          this.showError(`àªªà«àª°àª¶à«àª¨à«‹ àª²à«‹àª¡ àª•àª°àªµàª¾àª®àª¾àª‚ àª¸àª®àª¸à«àª¯àª¾ àª†àªµà«€: ${error.message}. àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ àªªà«‡àªœ àª°àª¿àª«à«àª°à«‡àª¶ àª•àª°à«‹.`);
        }
      }

      showQuestion() {
        if (this.currentIndex < this.totalQuestions) {
          this.updateProgress()
          this.renderQuestion()
        } else {
          this.showUserInfo()
        }
      }

      renderQuestion() {
        const question = this.questions[this.currentIndex]
        const currentAnswer = this.answers[`q${this.currentIndex}`]
        this.form.innerHTML = `
        <div class="question-card active">
          <h3 class="question-title">${this.currentIndex + 1}. ${question.question}</h3>
          <div class="options">${question.options
            .map((option, index) => {
              const value = ['a', 'b', 'c'][index]
              const isSelected = currentAnswer === value
              return `
                <label class="option ${isSelected ? 'selected' : ''}" data-value="${value}">
                  <input type="radio" name="currentAnswer" value="${value}" ${
                    isSelected ? 'checked' : ''
                  } required>${option}
                </label>
              `
            })
            .join('')}
          </div>
          <div class="navigation">${
            this.currentIndex > 0 ? '<button type="button" class="btn btn-secondary" id="prevBtn">àªªàª¾àª›àª³</button>' : '<div></div>'
          }
            <button type="button" class="btn btn-primary" id="nextBtn" disabled style="display: none;">àª†àª—àª³</button>
          </div>
        </div>
      `
        this.setupQuestionEventListeners()
      }

      setupQuestionEventListeners() {
        const options = this.form.querySelectorAll('.option')
        const nextBtn = document.getElementById('nextBtn')
        const prevBtn = document.getElementById('prevBtn')
        let isProcessing = false
        
        options.forEach((option) => {
          option.addEventListener('click', (e) => {
            if (isProcessing) {
              e.preventDefault()
              return
            }
            isProcessing = true
            options.forEach((opt) => opt.classList.remove('selected'))
            option.classList.add('selected')
            option.querySelector('input').checked = true
            nextBtn.disabled = false
            
            setTimeout(() => {
              if (!isProcessing) return
              const selected = this.form.querySelector('input[name="currentAnswer"]:checked')
              if (selected) {
                this.answers[`q${this.currentIndex}`] = selected.value
                this.currentIndex++
                isProcessing = false
                this.showQuestion()
              }
            }, 500)
          })
        })
        
        if (nextBtn) {
          nextBtn.addEventListener('click', () => {
            if (isProcessing) return
            const selected = this.form.querySelector('input[name="currentAnswer"]:checked')
            if (selected) {
              this.answers[`q${this.currentIndex}`] = selected.value
              this.currentIndex++
              this.showQuestion()
            }
          })
        }
        
        if (prevBtn) {
          prevBtn.addEventListener('click', () => {
            if (isProcessing) {
              isProcessing = false
            }
            this.currentIndex--
            this.showQuestion()
          })
        }
      }

      updateProgress() {
        const progress = (this.currentIndex / this.totalQuestions) * 100
        this.progressFill.style.width = `${progress}%`
        this.progressText.textContent = `àªªà«àª°àª¶à«àª¨ ${this.currentIndex + 1} / ${this.totalQuestions}`
      }

      validateName() {
        const nameInput = document.getElementById('nameInput')
        const nameError = document.getElementById('nameError')
        const nameIcon = document.getElementById('nameIcon')
        if (!nameInput) return false
        const name = nameInput.value.trim()
        const nameRegex = /^[a-zA-Zàª…-àª¹\s]+$/
        if (name === '') {
          this.showValidationError(nameInput, nameError, nameIcon, 'àª¨àª¾àª® àªœàª°à«‚àª°à«€ àª›à«‡')
          return false
        } else if (name.length < 2) {
          this.showValidationError(nameInput, nameError, nameIcon, 'àª¨àª¾àª® àª“àª›àª¾àª®àª¾àª‚ àª“àª›à«àª‚ 2 àª…àª•à«àª·àª° àª¹à«‹àªµà«àª‚ àªœà«‹àªˆàª')
          return false
        } else if (!nameRegex.test(name)) {
          this.showValidationError(nameInput, nameError, nameIcon, 'àª¨àª¾àª®àª®àª¾àª‚ àª«àª•à«àª¤ àª…àª•à«àª·àª°à«‹ àª…àª¨à«‡ àª¸à«àªªà«‡àª¸ àªœ àª®àª‚àªœà«‚àª° àª›à«‡')
          return false
        } else {
          this.showValidationSuccess(nameInput, nameError, nameIcon, 'àª¯à«‹àª—à«àª¯ àª¨àª¾àª®')
          return true
        }
      }

      validatePhone() {
        const phoneInput = document.getElementById('phoneInput')
        const phoneError = document.getElementById('phoneError')
        const phoneIcon = document.getElementById('phoneIcon')
        if (!phoneInput) return false
        const phone = phoneInput.value.trim()
        const phoneRegex = /^[6-9]\d{9}$/
        if (phone === '') {
          this.showValidationError(phoneInput, phoneError, phoneIcon, 'àª«à«‹àª¨ àª¨àª‚àª¬àª° àªœàª°à«‚àª°à«€ àª›à«‡')
          return false
        } else if (!/^\d+$/.test(phone)) {
          this.showValidationError(phoneInput, phoneError, phoneIcon, 'àª«àª•à«àª¤ àª¨àª‚àª¬àª° àªœ àª®àª‚àªœà«‚àª° àª›à«‡')
          return false
        } else if (phone.length !== 10) {
          this.showValidationError(phoneInput, phoneError, phoneIcon, 'àª«à«‹àª¨ àª¨àª‚àª¬àª° 10 àª…àª‚àª•àª¨à«‹ àª¹à«‹àªµà«‹ àªœà«‹àªˆàª')
          return false
        } else if (!phoneRegex.test(phone)) {
          this.showValidationError(phoneInput, phoneError, phoneIcon, 'àª«à«‹àª¨ àª¨àª‚àª¬àª° 6, 7, 8 àª…àª¥àªµàª¾ 9 àª¥à«€ àª¶àª°à«‚ àª¥àªµà«‹ àªœà«‹àªˆàª')
          return false
        } else {
          this.showValidationSuccess(phoneInput, phoneError, phoneIcon, 'àª¯à«‹àª—à«àª¯ àª«à«‹àª¨ àª¨àª‚àª¬àª°')
          return true
        }
      }

      validateEmail() {
        const emailInput = document.getElementById('emailInput')
        const emailError = document.getElementById('emailError')
        const emailIcon = document.getElementById('emailIcon')
        if (!emailInput) return false
        const email = emailInput.value.trim()
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
        if (email === '') {
          this.showValidationError(emailInput, emailError, emailIcon, 'àªˆàª®à«‡àª² àªœàª°à«‚àª°à«€ àª›à«‡')
          return false
        } else if (!email.includes('@')) {
          this.showValidationError(emailInput, emailError, emailIcon, 'àªˆàª®à«‡àª²àª®àª¾àª‚ @ àª¹à«‹àªµà«àª‚ àªœàª°à«‚àª°à«€ àª›à«‡')
          return false
        } else if (!emailRegex.test(email)) {
          this.showValidationError(emailInput, emailError, emailIcon, 'àª¯à«‹àª—à«àª¯ àªˆàª®à«‡àª² àª«à«‹àª°à«àª®à«‡àªŸ àª¨àª¥à«€')
          return false
        } else {
          this.showValidationSuccess(emailInput, emailError, emailIcon, 'àª¯à«‹àª—à«àª¯ àªˆàª®à«‡àª²')
          return true
        }
      }

      validateCity() {
        const cityInput = document.getElementById('cityInput')
        const cityError = document.getElementById('cityError')
        const cityIcon = document.getElementById('cityIcon')
        if (!cityInput) return false
        const city = cityInput.value.trim()
        const cityRegex = /^[a-zA-Zàª…-àª¹\s]+$/
        if (city === '') {
          this.showValidationError(cityInput, cityError, cityIcon, 'àª¶àª¹à«‡àª°àª¨à«àª‚ àª¨àª¾àª® àªœàª°à«‚àª°à«€ àª›à«‡')
          return false
        } else if (city.length < 2) {
          this.showValidationError(cityInput, cityError, cityIcon, 'àª¶àª¹à«‡àª°àª¨à«àª‚ àª¨àª¾àª® àª“àª›àª¾àª®àª¾àª‚ àª“àª›à«àª‚ 2 àª…àª•à«àª·àª° àª¹à«‹àªµà«àª‚ àªœà«‹àªˆàª')
          return false
        } else if (!cityRegex.test(city)) {
          this.showValidationError(cityInput, cityError, cityIcon, 'àª¶àª¹à«‡àª°àª¨àª¾ àª¨àª¾àª®àª®àª¾àª‚ àª«àª•à«àª¤ àª…àª•à«àª·àª°à«‹ àª…àª¨à«‡ àª¸à«àªªà«‡àª¸ àªœ àª®àª‚àªœà«‚àª° àª›à«‡')
          return false
        } else {
          this.showValidationSuccess(cityInput, cityError, cityIcon, 'àª¯à«‹àª—à«àª¯ àª¶àª¹à«‡àª°àª¨à«àª‚ àª¨àª¾àª®')
          return true
        }
      }

      validateGender() {
        const genderInputs = document.querySelectorAll('input[name="gender"]')
        const genderError = document.getElementById('genderError')
        const isSelected = Array.from(genderInputs).some((input) => input.checked)
        if (!isSelected) {
          genderError.textContent = 'àª²àª¿àª‚àª— àªªàª¸àª‚àª¦ àª•àª°àªµà«àª‚ àªœàª°à«‚àª°à«€ àª›à«‡'
          genderError.className = 'validation-message error'
          return false
        } else {
          genderError.style.display = 'none'
          return true
        }
      }

      showValidationError(input, errorElement, iconElement, message) {
        input.classList.remove('valid')
        input.classList.add('invalid')
        errorElement.textContent = message
        errorElement.className = 'validation-message error'
        if (iconElement) {
          iconElement.textContent = 'âœ—'
          iconElement.className = 'validation-icon invalid'
        }
      }

      showValidationSuccess(input, errorElement, iconElement, message) {
        input.classList.remove('invalid')
        input.classList.add('valid')
        errorElement.textContent = message
        errorElement.className = 'validation-message success'
        if (iconElement) {
          iconElement.textContent = 'âœ“'
          iconElement.className = 'validation-icon valid'
        }
      }

      showUserInfo() {
        this.form.style.display = 'none'
        this.userInfo.classList.add('active')
        this.progressFill.style.width = '100%'
        this.progressText.textContent = 'àªµà«àª¯àª•à«àª¤àª¿àª—àª¤ àª®àª¾àª¹àª¿àª¤à«€'
        setTimeout(() => {
          this.setupValidation()
        }, 100)
      }

      showQuestions() {
        this.userInfo.classList.remove('active')
        this.form.style.display = 'block'
        this.currentIndex = this.totalQuestions - 1
        this.showQuestion()
      }

      async submitSurvey() {
        const isNameValid = this.validateName();
        const isPhoneValid = this.validatePhone();
        const isEmailValid = this.validateEmail();
        const isCityValid = this.validateCity();
        const isGenderValid = this.validateGender();
        const allValid = isNameValid && isPhoneValid && isEmailValid && isCityValid && isGenderValid;
        
        if (!allValid) {
          this.showError('àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ àª¬àª§à«€ àª«à«€àª²à«àª¡ àª¯à«‹àª—à«àª¯ àª°à«€àª¤à«‡ àª­àª°à«‹ àª…àª¨à«‡ àª­à«‚àª²à«‹ àª¸à«àª§àª¾àª°à«‹.');
          return;
        }
        
        const formData = new FormData();
        const inputs = this.userInfo.querySelectorAll('input');
        inputs.forEach((input) => {
          if (input.type === 'radio' && input.checked) {
            formData.append(input.name, input.value);
          } else if (input.type !== 'radio') {
            formData.append(input.name, input.value.trim());
          }
        });
        
        const finalData = { ...this.answers };
        for (let [key, value] of formData.entries()) {
          finalData[key] = value;
        }
        
        this.showLoading();
        
        try {
          // Use relative URL for submit as well
          const apiUrl = '/api/submit';
          
          //console.log('Submitting to:', apiUrl);
          //console.log('Data being sent:', finalData);
          
          const response = await fetch(apiUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json',
              'X-Requested-With': 'XMLHttpRequest'
            },
            credentials: 'same-origin',
            body: JSON.stringify(finalData),
          });
          
          //console.log('Submit response status:', response.status);
          //console.log('Submit response headers:', [...response.headers.entries()]);
          
          const result = await response.json();
          //console.log('Submit result:', result);
          
          if (!response.ok || result.error) {
            this.showError(result.error || 'àªªàª°àª¿àª£àª¾àª® àª¸àª¾àªšàªµàªµàª¾àª®àª¾àª‚ àª¸àª®àª¸à«àª¯àª¾ àª†àªµà«€. àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ àª«àª°à«€àª¥à«€ àªªà«àª°àª¯àª¾àª¸ àª•àª°à«‹.');
          } else {
            this.showResult(result);
          }
        } catch (error) {
          //console.error('Detailed submission error:', error);
          //console.error('Error type:', error.constructor.name);
          //console.error('Error message:', error.message);
          this.showError(`àªªàª°àª¿àª£àª¾àª® àª¸àª¾àªšàªµàªµàª¾àª®àª¾àª‚ àª¸àª®àª¸à«àª¯àª¾ àª†àªµà«€: ${error.message}. àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ àª«àª°à«€àª¥à«€ àªªà«àª°àª¯àª¾àª¸ àª•àª°à«‹.`);
        }
      }

      showResult(data) {
        this.userInfo.classList.remove('active')
        this.loading.classList.remove('active')
        this.result.classList.add('active')
        document.getElementById('resultTitle').textContent = data.result
        document.getElementById('resultDescription').textContent = data.description
        document.getElementById('resultStats').innerHTML = `
        <div class="stat-card">
          <div class="stat-value">${data.counts.vata}</div>
          <div class="stat-label">àªµàª¾àª¤</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${data.counts.pitta}</div>
          <div class="stat-label">àªªàª¿àª¤à«àª¤</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${data.counts.kapha}</div>
          <div class="stat-label">àª•àª«</div>
        </div>
        <div class="download-section" style="margin-top: 40px; text-align: center;">
          <a href="/api/export-csv" class="btn btn-primary" style="display: inline-block; text-decoration: none; margin-top: 20px;">
            àª…àª¹àª¿àª¯àª¾àª‚ àª¤àª®àª¾àª°à«àª‚ àª†àª¹àª¾àª° àª¯à«‹àªœàª¨àª¾ àª¡àª¾àª‰àª¨àª²à«‹àª¡ àª•àª°à«‹
          </a>
        </div>
      `
        this.progressText.textContent = 'àªªà«‚àª°à«àª£ àª¥àª¯à«àª‚! ğŸ‰'
      }

      showLoading() {
        this.userInfo.classList.remove('active')
        this.loading.classList.add('active')
        this.progressText.textContent = 'àªªàª°àª¿àª£àª¾àª® àª¤à«ˆàª¯àª¾àª° àª•àª°à«€ àª°àª¹à«àª¯àª¾ àª›à«€àª...'
      }

      showError(message) {
        this.errorMessage.textContent = message
        this.errorMessage.classList.add('active')
        this.loading.classList.remove('active')
        setTimeout(() => {
          this.errorMessage.classList.remove('active')
        }, 5000)
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      new AyurvedicSurvey()
    })
  </script>
</body>
</html>
